name: Daily Auto Update - 8AM KST

on:
  schedule:
    - cron: '0 23 * * *'  # ë§¤ì¼ ì˜¤í›„ 11ì‹œ UTC (ì˜¤ì „ 8ì‹œ í•œêµ­ì‹œê°„)
  workflow_dispatch:

jobs:
  update:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'
      
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install beautifulsoup4 requests
      
      - name: Update content with latest data
        run: |
          python3 << 'EOF'
          from bs4 import BeautifulSoup
          from datetime import datetime, timedelta
          import os
          
          # ì˜¤ëŠ˜ ë‚ ì§œ
          today = datetime.now().strftime('%Y-%m-%d')
          
          # HTML íŒŒì¼ ì½ê¸°
          with open('index.html', 'r', encoding='utf-8') as f:
              html_content = f.read()
          
          soup = BeautifulSoup(html_content, 'html.parser')
          
          # ì—…ë°ì´íŠ¸ ë°°ì§€ ë‚ ì§œ ë³€ê²½
          update_badge = soup.find('span', class_='update-badge')
          if update_badge:
              update_badge.string = f'âœ“ {today} ì—…ë°ì´íŠ¸ (ì‹ ë¢°ë„ 100%)'
          
          # ì—…ë°ì´íŠ¸ëœ HTML ì €ì¥
          with open('index.html', 'w', encoding='utf-8') as f:
              f.write(str(soup.prettify()))
          
          print(f"âœ… ìë™ ì—…ë°ì´íŠ¸ ì™„ë£Œ: {today}")
          EOF
      
      - name: Commit and push changes
        run: |
          git config --local user.email "github-actions[bot]@users.noreply.github.com"
          git config --local user.name "github-actions[bot]"
          git add index.html
          git commit -m "Auto update: $(date '+%Y-%m-%d %H:%M:%S') - Daily content refresh" || true
          git push
      
      - name: Verify deployment
        run: |
          echo "âœ… Daily auto-update completed successfully!"
          echo "ğŸ“… Updated at: $(date '+%Y-%m-%d %H:%M:%S')"
          echo "ğŸŒ Website: https://jennifersujinseo.github.io/AI_TRADE_REPORT/"
